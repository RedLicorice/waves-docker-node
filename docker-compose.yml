version: '3.3'
services:
  postgres:
    container_name: postgres
    image: 'postgres:11-alpine'
    restart: always
    environment:
      - POSTGRES_PASSWORD=secret
    ports:
      - '5432:5432'
  
  wavesnode:
    image: wavesplatform/wavesnode
    container_name: wavesnode
    environment:
      - WAVES_NETWORK=MAINNET
      - WAVES_LOG_LEVEL=DEBUG
      - WAVES_HEAP_SIZE=2g
      - JAVA_OPTS='-Dwaves.network.declared-address=0.0.0.0:6868 -Dwaves.rest-api.port=6870 -Dwaves.rest-api.bind-address=0.0.0.0 -Dwaves.rest-api.enable=yes'
    volumes:
      - ./wavesnode-data/data:/var/lib/waves
    ports:
      - 6869:6869
      - 6868:6868
      - 6863:6863
      - 6864:6864
  
  crawler:
    image: wavesplatform/blockchain-postgres-sync
    container_name: crawler
    depends_on:
      - postgres
      - wavesnode
    environment:
      - 'NODE_ADDRESS=https://wavesnode'
      - PGHOST=postgres
      - PGDATABASE=postgres
      - PGUSER=postgres
      - PGPASSWORD=secret
      - MIGRATE=true